(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const v="https://api.themoviedb.org/3",G="c406e4cb77232ed2ff9c60d53f5c91e6",K="https://image.tmdb.org/t/p/w342";function h(t={}){return new URLSearchParams({api_key:G,language:"nl-NL",include_adult:"false",...t}).toString()}async function y(t){const e=await fetch(t);if(!e.ok)throw new Error(`TMDb error ${e.status}`);return e.json()}async function Y(t=1){const e=`${v}/trending/movie/week?${h({page:t})}`;return y(e)}function M(t){return t?`${K}${t}`:"https://placehold.co/342x513?text=No+Poster"}async function J(t,e=1){const n=`${v}/search/movie?${h({query:t,page:e})}`;return y(n)}async function R(t="nl-NL"){const e=`${v}/genre/movie/list?${h({language:t})}`;return y(e)}async function U({page:t=1,with_genres:e="",primary_release_year:n="",sort_by:a="popularity.desc"}={}){const r=`${v}/discover/movie?${h({page:t,with_genres:e,primary_release_year:n,sort_by:a})}`;return y(r)}async function V(t,e="nl-NL"){const n=`${v}/movie/${t}?${h({language:e})}`;return y(n)}const k="favorites_v1";function z(){try{const t=localStorage.getItem(k);return t?JSON.parse(t):[]}catch{return[]}}function x(t){localStorage.setItem(k,JSON.stringify(t))}function w(t,e){return t.some(n=>n.id===e)}function Q(t,e){if(w(t,e.id))return t;const n=[...t,{id:e.id,title:e.title,poster_path:e.poster_path}];return x(n),n}function O(t,e){const n=t.filter(a=>a.id!==e);return x(n),n}const c=document.getElementById("results"),W=document.getElementById("searchForm"),X=document.getElementById("searchInput"),E=document.getElementById("favoritesList"),P=document.getElementById("themeToggle"),Z=document.getElementById("scroll-sentinel"),f=document.getElementById("genreSelect"),L=document.getElementById("yearSelect"),_=document.getElementById("sortSelect"),d=document.getElementById("modal"),b=document.getElementById("modalBody"),ee=document.getElementById("modalClose");let l="trending",m="",i=1,p=1,$=!1,I="",S="",T="popularity.desc",s=z();function B(){if(E.innerHTML="",!s.length){E.innerHTML="<li><em>Nog geen favorieten.</em></li>";return}s.forEach(t=>{const e=document.createElement("li");e.innerHTML=`
      <img class="fav-thumb" src="${M(t.poster_path)}" alt="${t.title}">
      <span>${t.title}</span>
      <button class="fav-remove" aria-label="Verwijderen" data-id="${t.id}">‚ùå</button>
    `,E.appendChild(e)})}function te(t=[]){t.length&&(t.forEach(e=>{const n=document.createElement("div");n.className="card";const a=w(s,e.id)?"true":"false",r=w(s,e.id)?"‚ù§Ô∏è In favorieten":"‚ù§Ô∏è Favoriet";n.innerHTML=`
      <img class="poster" src="${M(e.poster_path)}" alt="${e.title}">
      <h3>${e.title}</h3>
      <p>üìÖ ${e.release_date??"Onbekend"}</p>
      <p>‚≠ê ${e.vote_average??"-"}</p>
      <button
        class="btn btn--fav"
        data-id="${e.id}"
        data-title="${e.title.replaceAll('"',"&quot;")}"
        data-poster-path="${e.poster_path??""}"
        aria-pressed="${a}"
      >${r}</button>
    `,c.appendChild(n)}),c.querySelectorAll(".btn--fav").forEach(e=>{e._wired||(e._wired=!0,e.addEventListener("click",()=>{const n=Number(e.dataset.id),a=e.dataset.title,r=e.dataset.posterPath||null;e.getAttribute("aria-pressed")==="true"?(s=O(s,n),e.setAttribute("aria-pressed","false"),e.textContent="‚ù§Ô∏è Favoriet"):(s=Q(s,{id:n,title:a,poster_path:r}),e.setAttribute("aria-pressed","true"),e.textContent="‚ù§Ô∏è In favorieten"),B()}))}))}function H(t=!0){let e=document.querySelector(".loading-more");t?e||(e=document.createElement("div"),e.className="loading-more",e.textContent="Meer laden‚Ä¶",c.after(e)):e&&e.remove()}async function g(t=!1){if(!$&&(t&&(i=1,p=1,c.innerHTML=""),!(i>p))){$=!0,H(!0);try{let e;if(l==="trending")e=await Y(i);else if(l==="search")e=await J(m,i);else if(l==="discover")e=await U({page:i,with_genres:I,primary_release_year:S,sort_by:T});else throw new Error("Onbekende mode: "+l);if(!e.results||e.results.length===0){p=i;return}p=e.total_pages||1,te(e.results||[]),i+=1}catch(e){console.error(e),c.innerHTML.trim()||(c.innerHTML=`<p>‚ö†Ô∏è Fout bij laden: ${e.message}</p>`)}finally{$=!1,H(!1)}}}async function ne(){l="trending",m="",await g(!0)}async function re(t){t.preventDefault();const e=X.value.trim();if(!e){l="trending",m="",await g(!0);return}l="search",m=e,f.value="",L.value="",_.value="popularity.desc",I="",S="",T="popularity.desc",await g(!0)}function ae(){E.addEventListener("click",t=>{const e=t.target.closest(".fav-remove");if(!e)return;const n=Number(e.dataset.id);s=O(s,n),B(),c.querySelectorAll(".btn--fav").forEach(a=>{Number(a.dataset.id)===n&&(a.setAttribute("aria-pressed","false"),a.textContent="‚ù§Ô∏è Favoriet")})})}const C="theme_v1";function j(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function q(t){const e=t||j();document.documentElement.setAttribute("data-theme",e),P.textContent=e==="dark"?"‚òÄÔ∏è":"üåô"}function oe(){const t=localStorage.getItem(C);q(t)}function se(){const e=(document.documentElement.getAttribute("data-theme")||j())==="dark"?"light":"dark";localStorage.setItem(C,e),q(e)}const ie=new IntersectionObserver(t=>{t[0].isIntersecting&&i<=p&&!$&&g(!1)},{root:null,rootMargin:"200px 0px",threshold:0});ie.observe(Z);function le(){f&&R().then(t=>{f.innerHTML='<option value="">Alle genres</option>'+(t.genres||[]).map(e=>`<option value="${e.id}">${e.name}</option>`).join("")}).catch(t=>{f.innerHTML='<option value="">(genres niet geladen)</option>',console.error("Fout bij laden van genres:",t)})}function ce(t=2025,e=1950){const n=['<option value="">Alle jaren</option>'];for(let a=t;a>=e;a--)n.push(`<option value="${a}">${a}</option>`);L.innerHTML=n.join("")}function de(){d.classList.remove("hidden"),d.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden"}function A(){d.classList.add("hidden"),d.setAttribute("aria-hidden","true"),document.body.style.overflow="",b.innerHTML=""}function ue(t){const{title:e,poster_path:n,release_date:a,runtime:r,vote_average:o,genres:u=[],overview:N}=t;b.innerHTML=`
    <img class="poster" src="${M(n)}" alt="${e}">
    <div class="modal-meta">
      <h2 id="modalTitle">${e}</h2>
      <div class="badges">
        ${a?`<span class="badge">üìÖ ${a}</span>`:""}
        ${Number.isFinite(r)?`<span class="badge">‚è±Ô∏è ${r} min</span>`:""}
        ${o?`<span class="badge">‚≠ê ${o.toFixed(1)}</span>`:""}
      </div>
      ${u.length?`<div class="badges">${u.map(D=>`<span class="badge">${D.name}</span>`).join("")}</div>`:""}
      ${N?`<p class="modal-overview">${N}</p>`:'<p class="modal-overview"><em>Geen beschrijving beschikbaar.</em></p>'}
    </div>
  `}c.addEventListener("click",async t=>{if(t.target.closest(".btn--fav"))return;const n=t.target.closest(".card");if(!n)return;const a=n.querySelector(".btn--fav");if(!a)return;const r=Number(a.dataset.id);if(r)try{b.innerHTML="<p class='modal-overview'>‚è≥ Details laden‚Ä¶</p>",de();const o=await V(r);ue(o)}catch(o){b.innerHTML=`<p class='modal-overview'>‚ö†Ô∏è Kon details niet laden: ${o.message}</p>`,console.error(o)}});ee.addEventListener("click",A);d.addEventListener("click",t=>{t.target===d&&A()});window.addEventListener("keydown",t=>{t.key==="Escape"&&!d.classList.contains("hidden")&&A()});window.addEventListener("load",()=>{oe?.(),B(),le(),ce(),ne(),ae?.()});W.addEventListener("submit",re);P.addEventListener("click",se);function F(){I=f.value,S=L.value,T=_.value||"popularity.desc",l="discover",m="",g(!0)}f?.addEventListener("change",F);L?.addEventListener("change",F);_?.addEventListener("change",F);
